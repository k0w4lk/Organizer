const addTaskErrorText=document.querySelector(".l-main-header__input-error"),addTaskText=document.querySelector(".l-main-header__input-task-text"),addTaskButton=document.querySelector(".l-main-header__new-task-add-button"),doneTaskButton=document.querySelector(".l-main-tasks__done-button"),undoneTaskButton=document.querySelector(".l-main-tasks__undone-button"),tbdButtons=document.querySelector("#to-be-done-mass-action-buttons"),doneButtons=document.querySelector("#done-mass-action-buttons"),deleteTaskButton=document.querySelector("#to-be-done-delete-button"),deleteDoneTaskButton=document.querySelector("#done-delete-button"),toBeDone=document.querySelector("#tasks-to-be-done-container"),tasksToBeDone=document.querySelector("#to-be-done-list"),toBeDoneCounter=document.querySelector(".l-main__tbd-counter"),done=document.querySelector("#tasks-done-container"),tasksDone=document.querySelector("#done-list"),doneCounter=document.querySelector("#tasks-done-counter");let tbdData,doneData;function chooseToBeDoneTask(t){if("checkbox"===t.target.getAttribute("type")){for(let e of tbdData)e.id===t.target.parentNode.dataset.id&&(e.checked=!e.checked,saveData());changeCheckboxStatus(tbdData,tasksDone),t.target.nextSibling.classList.toggle("task-checked"),changeEditButtonsStatus(tasksToBeDone),functionalButtonsStatus(tasksToBeDone,deleteTaskButton,doneTaskButton,tbdButtons)}}function chooseDoneTask(t){if("checkbox"===t.target.getAttribute("type")){for(let e of doneData)e.id===t.target.parentNode.dataset.id&&(e.checked=!e.checked,saveData());changeCheckboxStatus(doneData,tasksToBeDone),t.target.nextSibling.classList.toggle("task-checked"),changeEditButtonsStatus(tasksDone),functionalButtonsStatus(tasksDone,deleteDoneTaskButton,undoneTaskButton,doneButtons)}}function changeEditButtonsStatus(t){let e=t.querySelectorAll(".task-checked"),a=t.querySelectorAll("button");for(button of a)e.length>1?button.setAttribute("disabled",""):button.removeAttribute("disabled")}function resetChosenTasks(t){for(let e of t)e.checked=!1,saveData()}function changeCheckboxStatus(t,e){let a=0;for(let e of t)e.checked&&a++;let n=e.querySelectorAll(".task-checkbox");if(a)for(let t of n)t.setAttribute("disabled","disabled");else for(let t of n)t.removeAttribute("disabled")}function getTasks(){tbdData=JSON.parse(localStorage.getItem("tbdData"))||[],doneData=JSON.parse(localStorage.getItem("doneData"))||[]}function createTaskTemplate(t,e){const a=document.createElement("li"),n=document.createElement("span"),o=document.createElement("input"),s=document.createElement("button");o.setAttribute("type","checkbox"),o.classList.add("task-checkbox"),n.innerText=t.task,n.classList.add("task-text"),s.setAttribute("data-button-name","Редактировать"),s.setAttribute("title","Редактировать"),s.classList.add("edit-button"),a.setAttribute("data-id",t.id),a.classList.add("task-container"),a.append(o,n,s),e.append(a),addTaskText.value=""}function renderTasks(){getTasks(),tasksToBeDone.innerHTML="";for(let t of tbdData)createTaskTemplate(t,tasksToBeDone);tasksDone.innerHTML="";for(let t of doneData)createTaskTemplate(t,tasksDone);functionalButtonsStatus(tasksToBeDone,deleteTaskButton,doneTaskButton,tbdButtons),functionalButtonsStatus(tasksDone,deleteDoneTaskButton,undoneTaskButton,doneButtons),counterUpdate(toBeDoneCounter,tasksToBeDone),counterUpdate(doneCounter,tasksDone),resetChosenTasks(tbdData),resetChosenTasks(doneData)}function functionalButtonsStatus(t,e,a,n){0!==t.querySelectorAll(".task-checked").length?(e.removeAttribute("disabled"),a.removeAttribute("disabled")):(e.setAttribute("disabled",""),a.setAttribute("disabled","")),0===t.children.length?n.style.display="none":n.style.display="block"}function editTask(t){if("BUTTON"===t.target.tagName)if("Редактировать"!==t.target.getAttribute("data-button-name")){if("Сохранить"===t.target.getAttribute("data-button-name")){let e=t.target.previousSibling.value,a=t.target.parentNode.getAttribute("data-id");return tbdData=tbdData.map(t=>t.id===a?(t.task=e,t):t),saveData(),void renderTasks()}}else{deleteTaskButton.setAttribute("disabled",""),doneTaskButton.setAttribute("disabled",""),t.target.style;let e=document.querySelectorAll("input[type='checkbox']");for(let t of e)t.setAttribute("disabled","");let a=t.target.previousSibling.textContent,n=document.createElement("input");t.target.previousSibling.replaceWith(n),t.target.setAttribute("data-button-name","Сохранить");let o=document.querySelectorAll("button");for(let t of o)"Редактировать"===t.getAttribute("data-button-name")&&t.setAttribute("disabled","");n.value=a}}function editDoneTask(t){if("BUTTON"===t.target.tagName)if("Редактировать"!==t.target.getAttribute("data-button-name")){if("Сохранить"===t.target.getAttribute("data-button-name")){let e=t.target.previousSibling.value,a=t.target.parentNode.getAttribute("data-id");return doneData=doneData.map(t=>t.id===a?(t.task=e,t):t),saveData(),void renderTasks()}}else{deleteDoneTaskButton.setAttribute("disabled",""),undoneTaskButton.setAttribute("disabled","");let e=document.querySelectorAll("input[type='checkbox']");for(let t of e)t.setAttribute("disabled","");let a=t.target.previousSibling.textContent,n=document.createElement("input");t.target.previousSibling.replaceWith(n),t.target.setAttribute("data-button-name","Сохранить");let o=document.querySelectorAll("button");for(let t of o)"Редактировать"===t.getAttribute("data-button-name")&&t.setAttribute("disabled","");n.value=a}}function onAddTask(){const t=Math.random().toString(32).slice(3),e=addTaskText.value;addTaskText.focus(),createTask(t,e,!1,toEdit=void 0)}function createTask(t,e,a,n){e?(saveData({id:t,task:e,checked:a,toEdit:n}),renderTasks()):addTaskErrorText.innerText="Вы не ввели название задачи"}function saveData(t){t?localStorage.setItem("tbdData",JSON.stringify([...tbdData,{id:t.id,task:t.task,checked:t.checked,toEdit:t.toEdit}])):(localStorage.setItem("tbdData",JSON.stringify([...tbdData])),localStorage.setItem("doneData",JSON.stringify([...doneData])))}function doneTask(){let t=document.querySelector(".l-main__tbd-tasks");for(task of t.children)task.children[1].classList.contains("task-checked")&&(tbdData=tbdData.filter(t=>task.getAttribute("data-id")!==t.id||(doneData.push(t),!1)));saveData(),renderTasks()}function undoneTask(){let t=document.querySelector(".l-main__done-tasks");for(task of t.children)task.children[1].classList.contains("task-checked")&&(doneData=doneData.filter(t=>task.getAttribute("data-id")!==t.id||(tbdData.push(t),!1)));saveData(),renderTasks()}function onDeleteTBDTask(){let t=tasksToBeDone;for(task of t.children)task.children[1].classList.contains("task-checked")&&(tbdData=tbdData.filter(t=>!(task.getAttribute("data-id")===t.id)));saveData(),renderTasks()}function onDeleteDoneTask(){let t=tasksDone;for(task of t.children)task.children[1].classList.contains("task-checked")&&(doneData=doneData.filter(t=>!(task.getAttribute("data-id")===t.id)));saveData(),renderTasks()}function counterUpdate(t,e){t.innerText=e.children.length}addTaskText.addEventListener("blur",()=>{addTaskErrorText.innerText=""}),addTaskText.addEventListener("input",()=>{addTaskErrorText.innerText="",30===addTaskText.value.length&&(addTaskErrorText.innerText="Максимальное количество символов - 30")}),renderTasks(),counterUpdate(toBeDoneCounter,tasksToBeDone),counterUpdate(doneCounter,tasksDone),addTaskButton.addEventListener("click",onAddTask),tasksToBeDone.addEventListener("click",chooseToBeDoneTask),tasksDone.addEventListener("click",chooseDoneTask),tasksToBeDone.addEventListener("click",editTask),tasksDone.addEventListener("click",editDoneTask),deleteTaskButton.addEventListener("click",onDeleteTBDTask),deleteDoneTaskButton.addEventListener("click",onDeleteDoneTask),doneTaskButton.addEventListener("click",doneTask),undoneTaskButton.addEventListener("click",undoneTask);