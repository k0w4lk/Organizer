const addTaskErrorText=document.querySelector(".l-main-header__input-error"),addTaskText=document.querySelector(".l-main-header__input-task-text"),addTaskButton=document.querySelector(".l-main-header__new-task-add-button"),toBeDone=document.querySelector("#tasks-to-be-done-container"),toBeDoneCounter=document.querySelector("#tasks-to-be-done-counter"),tbdButtons=document.querySelector("#to-be-done-mass-action-buttons"),chooseAllToBeDoneTasksButton=document.querySelector("#choose-all-to-be-done-tasks-button"),doneTaskButton=document.querySelector(".l-main-tasks__done-button"),deleteTaskButton=document.querySelector("#to-be-done-delete-button"),tasksToBeDone=document.querySelector("#to-be-done-list"),done=document.querySelector("#tasks-done-container"),doneCounter=document.querySelector("#tasks-done-counter"),doneButtons=document.querySelector("#done-mass-action-buttons"),chooseAllDoneTasksButton=document.querySelector("#choose-all-done-tasks-button"),undoneTaskButton=document.querySelector(".l-main-tasks__undone-button"),deleteDoneTaskButton=document.querySelector("#done-delete-button"),tasksDone=document.querySelector("#done-list");let tbdData,doneData;function getTasks(){tbdData=JSON.parse(localStorage.getItem("tbdData"))||[],doneData=JSON.parse(localStorage.getItem("doneData"))||[]}function saveData(t){t?localStorage.setItem("tbdData",JSON.stringify([...tbdData,{id:t.id,task:t.task,checked:t.checked,toEdit:t.toEdit}])):(localStorage.setItem("tbdData",JSON.stringify([...tbdData])),localStorage.setItem("doneData",JSON.stringify([...doneData])))}function renderTasks(){getTasks(),tasksToBeDone.innerHTML="";for(let t of tbdData)createTaskTemplate(t,tasksToBeDone);tasksDone.innerHTML="";for(let t of doneData)createTaskTemplate(t,tasksDone);functionalButtonsStatus(tasksToBeDone,deleteTaskButton,doneTaskButton,tbdButtons),functionalButtonsStatus(tasksDone,deleteDoneTaskButton,undoneTaskButton,doneButtons),counterUpdate(toBeDoneCounter,tasksToBeDone),counterUpdate(doneCounter,tasksDone),resetChosenTasks(tbdData,chooseAllToBeDoneTasksButton,chooseAllDoneTasksButton),resetChosenTasks(doneData,chooseAllDoneTasksButton,chooseAllToBeDoneTasksButton)}function createTask(t,e,a,n){e?(saveData({id:t,task:e,checked:a,toEdit:n}),renderTasks()):addTaskErrorText.innerText="You have not entered a task name"}function onAddTask(){const t=Math.random().toString(32).slice(3),e=addTaskText.value;addTaskText.focus(),createTask(t,e,!1,toEdit=void 0)}function chooseToBeDoneTask(t){if("checkbox"===t.target.getAttribute("type")){for(let e of tbdData)e.id===t.target.parentNode.dataset.id&&(e.checked=!e.checked,saveData());changeCheckboxStatus(tbdData,tasksDone),t.target.nextSibling.classList.toggle("l-main-task_checked"),changeEditButtonsStatus(tasksToBeDone),functionalButtonsStatus(tasksToBeDone,deleteTaskButton,doneTaskButton,tbdButtons)}}function chooseDoneTask(t){if("checkbox"===t.target.getAttribute("type")){for(let e of doneData)e.id===t.target.parentNode.dataset.id&&(e.checked=!e.checked,saveData());changeCheckboxStatus(doneData,tasksToBeDone),t.target.nextSibling.classList.toggle("l-main-task_checked"),changeEditButtonsStatus(tasksDone),functionalButtonsStatus(tasksDone,deleteDoneTaskButton,undoneTaskButton,doneButtons)}}function chooseAllTasks(t,e,a,n,o){for(item of(t.forEach(t=>t.checked?t.checked=!1:t.checked=!0),saveData(),t))if(!0===item.checked)for(let t=0;t<e.children.length;t++)item.id===e.children[t].dataset.id&&(e.children[t].children[0].checked=!0,e.children[t].children[1].classList.add("l-main-task_checked"));else for(let t=0;t<e.children.length;t++)item.id===e.children[t].dataset.id&&(e.children[t].children[0].checked=!1,e.children[t].children[1].classList.remove("l-main-task_checked"));o.disabled?o.disabled=!1:o.disabled=!0,changeCheckboxStatus(t,n),changeEditButtonsStatus(e)}function changeEditButtonsStatus(t){let e=t.querySelectorAll(".l-main-task_checked"),a=t.querySelectorAll("button");for(button of a)e.length>1?button.setAttribute("disabled",""):button.removeAttribute("disabled")}function resetChosenTasks(t,e,a){for(let n of t)n.checked=!1,e.checked=!1,a.disabled=!1,saveData()}function changeCheckboxStatus(t,e){let a=0;for(let e of t)e.checked&&a++;let n=e.querySelectorAll(".l-main-task__checkbox");if(a)for(let t of n)t.setAttribute("disabled","disabled");else for(let t of n)t.removeAttribute("disabled")}function createTaskTemplate(t,e){const a=document.createElement("li"),n=document.createElement("span"),o=document.createElement("input"),s=document.createElement("button");o.setAttribute("type","checkbox"),o.classList.add("l-main-task__checkbox"),n.innerText=t.task,n.classList.add("l-main-task__text"),s.setAttribute("data-button-name","Edit"),s.setAttribute("title","Edit"),s.classList.add("l-main-task__edit-button"),a.setAttribute("data-id",t.id),a.classList.add("l-main-task__container"),a.append(o,n,s),e.append(a),addTaskText.value=""}function functionalButtonsStatus(t,e,a,n){0!==t.querySelectorAll(".l-main-task_checked").length?(e.removeAttribute("disabled"),a.removeAttribute("disabled")):(e.setAttribute("disabled",""),a.setAttribute("disabled","")),0===t.children.length?(n.classList.add("l-main-tasks__mass-action-buttons_hidden"),n.classList.remove("l-main-tasks__mass-action-buttons_active")):(n.classList.add("l-main-tasks__mass-action-buttons_active"),n.classList.remove("l-main-tasks__mass-action-buttons_hidden"))}function editTask(t){if("BUTTON"===t.target.tagName)if("Edit"!==t.target.getAttribute("data-button-name")){if("Save"===t.target.getAttribute("data-button-name")){let e=t.target.previousSibling.value,a=t.target.parentNode.getAttribute("data-id");return tbdData=tbdData.map(t=>t.id===a?(t.task=e,t):t),saveData(),void renderTasks()}}else{deleteTaskButton.setAttribute("disabled",""),doneTaskButton.setAttribute("disabled",""),t.target.style;let e=document.querySelectorAll(".l-main-task__checkbox");for(let t of e)t.setAttribute("disabled","");let a=t.target.previousSibling.textContent,n=document.createElement("input");n.classList.add("l-main-task__edit-input"),n.setAttribute("maxlength","30"),t.target.previousSibling.replaceWith(n),t.target.setAttribute("data-button-name","Save");let o=document.querySelectorAll("button");for(let t of o)"Edit"===t.getAttribute("data-button-name")&&t.setAttribute("disabled","");n.value=a}}function editDoneTask(t){if("BUTTON"===t.target.tagName)if("Edit"!==t.target.getAttribute("data-button-name")){if("Save"===t.target.getAttribute("data-button-name")){let e=t.target.previousSibling.value,a=t.target.parentNode.getAttribute("data-id");return doneData=doneData.map(t=>t.id===a?(t.task=e,t):t),saveData(),void renderTasks()}}else{deleteDoneTaskButton.setAttribute("disabled",""),undoneTaskButton.setAttribute("disabled","");let e=document.querySelectorAll(".l-main-task__checkbox");for(let t of e)t.setAttribute("disabled","");let a=t.target.previousSibling.textContent,n=document.createElement("input");n.classList.add("l-main-task__edit-input"),n.setAttribute("maxlength","30"),t.target.previousSibling.replaceWith(n),t.target.setAttribute("data-button-name","Save");let o=document.querySelectorAll("button");for(let t of o)"Edit"===t.getAttribute("data-button-name")&&t.setAttribute("disabled","");n.value=a}}function doneTask(){let t=tasksToBeDone;for(task of t.children)task.children[1].classList.contains("l-main-task_checked")&&(tbdData=tbdData.filter(t=>task.getAttribute("data-id")!==t.id||(doneData.push(t),!1)));saveData(),renderTasks()}function undoneTask(){let t=document.querySelector(".l-main__done-tasks");for(task of t.children)task.children[1].classList.contains("l-main-task_checked")&&(doneData=doneData.filter(t=>task.getAttribute("data-id")!==t.id||(tbdData.push(t),!1)));saveData(),renderTasks()}function onDeleteTBDTask(){let t=tasksToBeDone;for(task of t.children)task.children[1].classList.contains("l-main-task_checked")&&(tbdData=tbdData.filter(t=>!(task.getAttribute("data-id")===t.id)));saveData(),renderTasks()}function onDeleteDoneTask(){let t=tasksDone;for(task of t.children)task.children[1].classList.contains("l-main-task_checked")&&(doneData=doneData.filter(t=>!(task.getAttribute("data-id")===t.id)));saveData(),renderTasks()}function counterUpdate(t,e){t.innerText=e.children.length}chooseAllToBeDoneTasksButton.addEventListener("click",()=>chooseAllTasks(tbdData,tasksToBeDone,doneData,tasksDone,chooseAllDoneTasksButton)),chooseAllDoneTasksButton.addEventListener("click",()=>chooseAllTasks(doneData,tasksDone,tbdData,tasksToBeDone,chooseAllToBeDoneTasksButton)),addTaskText.addEventListener("blur",()=>{addTaskErrorText.innerText=""}),addTaskText.addEventListener("input",()=>{addTaskErrorText.innerText="",30===addTaskText.value.length&&(addTaskErrorText.innerText="The maximum number of characters is 30")}),renderTasks(),counterUpdate(toBeDoneCounter,tasksToBeDone),counterUpdate(doneCounter,tasksDone),addTaskButton.addEventListener("click",onAddTask),tasksToBeDone.addEventListener("click",chooseToBeDoneTask),tasksDone.addEventListener("click",chooseDoneTask),tasksToBeDone.addEventListener("click",editTask),tasksDone.addEventListener("click",editDoneTask),deleteTaskButton.addEventListener("click",onDeleteTBDTask),deleteDoneTaskButton.addEventListener("click",onDeleteDoneTask),doneTaskButton.addEventListener("click",doneTask),undoneTaskButton.addEventListener("click",undoneTask);