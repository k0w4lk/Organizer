const addTaskText=document.querySelector(".l-main-header__new-task-text"),addTaskButton=document.querySelector(".l-main-header__new-task-add"),doneTaskButton=document.querySelector(".done-task-button"),undoneTaskButton=document.querySelector(".undone-task-button"),tbdButtons=document.querySelector(".l-main__tbd-buttons"),doneButtons=document.querySelector(".l-main__done-buttons"),deleteTaskButton=document.querySelector(".delete-task-button"),deleteDoneTaskButton=document.querySelector(".delete-done-task-button"),toBeDone=document.querySelector(".l-main__tbd"),tasksToBeDone=document.querySelector(".l-main__tbd-tasks"),toBeDoneCounter=document.querySelector(".l-main__tbd-counter"),done=document.querySelector(".l-main__done"),tasksDone=document.querySelector(".l-main__done-tasks"),doneCounter=document.querySelector(".l-main__done-counter"),inputErrorText=document.querySelector(".l-main-header__input-error");let tbdData,doneData;function chooseToBeDoneTask(t){if("checkbox"===t.target.getAttribute("type")){for(let e of tbdData)e.id===t.target.parentNode.dataset.id&&(e.checked=!e.checked,saveData());changeCheckboxStatus(tbdData,tasksDone),t.target.nextSibling.classList.toggle("task-checked"),changeEditButtonsStatus(tasksToBeDone),buttonsStatus()}}function chooseDoneTask(t){if("checkbox"===t.target.getAttribute("type")){for(let e of doneData)e.id===t.target.parentNode.dataset.id&&(e.checked=!e.checked,saveData());changeCheckboxStatus(doneData,tasksToBeDone),t.target.nextSibling.classList.toggle("task-checked"),changeEditButtonsStatus(tasksDone),buttonsDoneStatus()}}function changeEditButtonsStatus(t){let e=t.querySelectorAll(".task-checked"),a=t.querySelectorAll("button");for(button of a)e.length>1?button.setAttribute("disabled",""):button.removeAttribute("disabled")}function chooseReset(t){for(let e of t)e.checked=!1,saveData()}function changeCheckboxStatus(t,e){let a=0;for(let e of t)e.checked&&a++;let n=e.querySelectorAll(".task-checkbox");if(a)for(let t of n)t.setAttribute("disabled","disabled");else for(let t of n)t.removeAttribute("disabled")}function getTasks(){tbdData=JSON.parse(localStorage.getItem("tbdData"))||[],doneData=JSON.parse(localStorage.getItem("doneData"))||[]}function createTaskTemplate(t){const e=document.createElement("li"),a=document.createElement("span"),n=document.createElement("input"),o=document.createElement("button");n.setAttribute("type","checkbox"),n.classList.add("task-checkbox"),a.innerText=t.task,o.setAttribute("data-button-name","Редактировать"),o.setAttribute("title","Редактировать"),o.classList.add("edit-button"),e.setAttribute("data-id",t.id),e.append(n,a,o),tasksToBeDone.append(e),addTaskText.value=""}function createTaskDoneTemplate(t){const e=document.createElement("li"),a=document.createElement("span"),n=document.createElement("input"),o=document.createElement("button");n.setAttribute("type","checkbox"),n.classList.add("task-checkbox"),a.innerText=t.task,o.setAttribute("data-button-name","Редактировать"),o.setAttribute("title","Редактировать"),o.classList.add("edit-button"),e.setAttribute("data-id",t.id),e.append(n,a,o),tasksDone.append(e)}function renderTasks(){getTasks(),tasksToBeDone.innerHTML="";for(let t of tbdData)createTaskTemplate(t);tasksDone.innerHTML="";for(let t of doneData)createTaskDoneTemplate(t);buttonsStatus(),buttonsDoneStatus(),counterUpdate(toBeDoneCounter,tasksToBeDone),counterUpdate(doneCounter,tasksDone),chooseReset(tbdData),chooseReset(doneData)}function buttonsStatus(){0!==tasksToBeDone.querySelectorAll(".task-checked").length?(deleteTaskButton.removeAttribute("disabled"),doneTaskButton.removeAttribute("disabled")):(deleteTaskButton.setAttribute("disabled",""),doneTaskButton.setAttribute("disabled","")),0===tasksToBeDone.children.length?tbdButtons.style.display="none":tbdButtons.style.display="block"}function buttonsDoneStatus(){0!==tasksDone.querySelectorAll(".task-checked").length?(deleteDoneTaskButton.removeAttribute("disabled"),undoneTaskButton.removeAttribute("disabled")):(deleteDoneTaskButton.setAttribute("disabled",""),undoneTaskButton.setAttribute("disabled","")),0===tasksDone.children.length?doneButtons.style.display="none":doneButtons.style.display="block"}function editTask(t){if("BUTTON"===t.target.tagName)if("Редактировать"!==t.target.getAttribute("data-button-name")){if("Сохранить"===t.target.getAttribute("data-button-name")){let e=t.target.previousSibling.value,a=t.target.parentNode.getAttribute("data-id");return tbdData=tbdData.map(t=>t.id===a?(t.task=e,t):t),saveData(),void renderTasks()}}else{deleteTaskButton.setAttribute("disabled",""),doneTaskButton.setAttribute("disabled","");let e=document.querySelectorAll("input[type='checkbox']");for(let t of e)t.setAttribute("disabled","");let a=t.target.previousSibling.textContent,n=document.createElement("input");t.target.previousSibling.replaceWith(n),t.target.setAttribute("data-button-name","Сохранить");let o=document.querySelectorAll("button");for(let t of o)"Редактировать"===t.getAttribute("data-button-name")&&t.setAttribute("disabled","");n.value=a}}function editDoneTask(t){if("BUTTON"===t.target.tagName)if("Редактировать"!==t.target.getAttribute("data-button-name")){if("Сохранить"===t.target.getAttribute("data-button-name")){let e=t.target.previousSibling.value,a=t.target.parentNode.getAttribute("data-id");return doneData=doneData.map(t=>t.id===a?(t.task=e,t):t),saveData(),void renderTasks()}}else{deleteDoneTaskButton.setAttribute("disabled",""),undoneTaskButton.setAttribute("disabled","");let e=document.querySelectorAll("input[type='checkbox']");for(let t of e)t.setAttribute("disabled","");let a=t.target.previousSibling.textContent,n=document.createElement("input");t.target.previousSibling.replaceWith(n),t.target.setAttribute("data-button-name","Сохранить");let o=document.querySelectorAll("button");for(let t of o)"Редактировать"===t.getAttribute("data-button-name")&&t.setAttribute("disabled","");n.value=a}}function onAddTask(){const t=Math.random().toString(32).slice(3),e=addTaskText.value;addTaskText.focus(),createTask(t,e,!1,toEdit=void 0)}function createTask(t,e,a,n){e?(saveData({id:t,task:e,checked:a,toEdit:n}),renderTasks()):inputErrorText.innerText="Вы не ввели название задачи"}function saveData(t){t?localStorage.setItem("tbdData",JSON.stringify([...tbdData,{id:t.id,task:t.task,checked:t.checked,toEdit:t.toEdit}])):(localStorage.setItem("tbdData",JSON.stringify([...tbdData])),localStorage.setItem("doneData",JSON.stringify([...doneData])))}function doneTask(){let t=document.querySelector(".l-main__tbd-tasks");for(task of t.children)task.children[1].classList.contains("task-checked")&&(tbdData=tbdData.filter(t=>task.getAttribute("data-id")!==t.id||(doneData.push(t),!1)));saveData(),renderTasks()}function undoneTask(){let t=document.querySelector(".l-main__done-tasks");for(task of t.children)task.children[1].classList.contains("task-checked")&&(doneData=doneData.filter(t=>task.getAttribute("data-id")!==t.id||(tbdData.push(t),!1)));saveData(),renderTasks()}function onDeleteTBDTask(){let t=tasksToBeDone;for(task of t.children)task.children[1].classList.contains("task-checked")&&(tbdData=tbdData.filter(t=>!(task.getAttribute("data-id")===t.id)));saveData(),renderTasks()}function onDeleteDoneTask(){let t=tasksDone;for(task of t.children)task.children[1].classList.contains("task-checked")&&(doneData=doneData.filter(t=>!(task.getAttribute("data-id")===t.id)));saveData(),renderTasks()}function counterUpdate(t,e){t.innerText=e.children.length}addTaskText.addEventListener("blur",()=>{inputErrorText.innerText=""}),addTaskText.addEventListener("input",()=>{inputErrorText.innerText="",30===addTaskText.value.length&&(inputErrorText.innerText="Максимальное количество символов - 30")}),renderTasks(),buttonsStatus(),buttonsDoneStatus(),counterUpdate(toBeDoneCounter,tasksToBeDone),counterUpdate(doneCounter,tasksDone),addTaskButton.addEventListener("click",onAddTask),tasksToBeDone.addEventListener("click",chooseToBeDoneTask),tasksDone.addEventListener("click",chooseDoneTask),tasksToBeDone.addEventListener("click",editTask),tasksDone.addEventListener("click",editDoneTask),deleteTaskButton.addEventListener("click",onDeleteTBDTask),deleteDoneTaskButton.addEventListener("click",onDeleteDoneTask),doneTaskButton.addEventListener("click",doneTask),undoneTaskButton.addEventListener("click",undoneTask);