"use strict";const newTaskText=document.querySelector("#new-task-text"),newTaskAdd=document.querySelector("#new-task-add"),newTaskError=document.querySelector("#new-task-error"),counterTBD=document.querySelector("#counter-TBD"),counterDone=document.querySelector("#counter-done"),massButtonsTBD=document.querySelector("#mass-buttons-TBD"),massButtonsDone=document.querySelector("#mass-buttons-done"),chooseAllTBD=document.querySelector("#choose-all-TBD"),chooseAllDone=document.querySelector("#choose-all-done"),allToDone=document.querySelector("#all-to-done"),allToExecution=document.querySelector("#all-to-execution"),deleteAllTBD=document.querySelector("#delete-all-TBD"),deleteAllDone=document.querySelector("#delete-all-done"),listTBD=document.querySelector("#list-TBD"),listDone=document.querySelector("#list-done");let dataTBD,dataDone;function getTasksData(){dataTBD=JSON.parse(localStorage.getItem("dataTBD"))||[],dataDone=JSON.parse(localStorage.getItem("dataDone"))||[]}function saveTasksData(e){e?localStorage.setItem("dataTBD",JSON.stringify([...dataTBD,{text:e.taskText,id:e.taskID,isChecked:e.isChecked,toEdit:e.toEdit}])):(localStorage.setItem("dataTBD",JSON.stringify([...dataTBD])),localStorage.setItem("dataDone",JSON.stringify([...dataDone])))}function addNewTask(){const e=newTaskText.value;if(newTaskText.focus(),!e)return void(newTaskError.innerText="You have not entered a task name");const t=Math.random().toString(32).slice(3);newTaskText.value="",resetCheckboxesStatuses(),massButtonActivity(),saveTasksData({taskText:e,taskID:t,isChecked:!1,toEdit:!1}),renderTasks()}function createNewTaskTemplate(e,t){const a=document.createElement("li");a.dataset.id=e.id,a.classList.add("l-main-task__container");const s=document.createElement("input");s.setAttribute("type","checkbox"),s.checked=e.isChecked,s.classList.add("l-main-task__checkbox");const o=document.createElement("span");o.innerText=e.text;const n=document.createElement("button");n.classList.add("l-main-task__edit-button"),n.dataset.edit="edit",a.append(s,o,n),t.append(a)}function renderTasks(){getTasksData(),listTBD.innerHTML="",listDone.innerHTML="",dataTBD.forEach(e=>createNewTaskTemplate(e,listTBD)),dataDone.forEach(e=>createNewTaskTemplate(e,listDone)),updateTasksCounter(counterTBD,listTBD),updateTasksCounter(counterDone,listDone),chooseAllDone.disabled=!1,chooseAllTBD.disabled=!1}function resetCheckboxesStatuses(){chooseAllTBD.checked=!1,chooseAllDone.checked=!1;let e=document.querySelectorAll(".l-main-task__checkbox");console.log(e),e.forEach(e=>{e.checked=!1,e.nextSibling.classList.remove("l-main-task_checked")}),dataTBD.forEach(e=>{e.isChecked=!1,e.toEdit=!1}),dataDone.forEach(e=>{e.isChecked=!1,e.toEdit=!1}),saveTasksData()}function clearNewTaskErrorText(){newTaskError.innerText=""}function updateTasksCounter(e,t){e.innerText=t.children.length,massButtonsDisplay()}function chooseAllTasks(e,t,a){t.checked?e.forEach(e=>e.isChecked=!0):(e.forEach(e=>e.isChecked=!1),unlockCheckboxesDone()),saveTasksData(),renderTasks(),t.checked?("list-TBD"===a.id&&(chooseAllDone.disabled=!0,lockCheckboxesDone()),"list-done"===a.id&&(chooseAllTBD.disabled=!0,lockCheckboxesTBD())):("list-TBD"===a.id&&(chooseAllDone.disabled=!1,unlockCheckboxesDone()),"list-done"===a.id&&(chooseAllTBD.disabled=!1,unlockCheckboxesTBD())),massButtonActivity()}function moveTasksToDone(){dataTBD=dataTBD.filter(e=>!e.isChecked||(dataDone.push(e),!1)),saveTasksData(),resetCheckboxesStatuses(),renderTasks(),massButtonActivity()}function moveTasksToExecution(){dataDone=dataDone.filter(e=>!e.isChecked||(dataTBD.push(e),!1)),saveTasksData(),resetCheckboxesStatuses(),renderTasks()}function chooseTask(e,t,a){e.target.classList.contains("l-main-task__checkbox")&&(t.forEach(t=>{t.id===e.target.parentNode.dataset.id&&(e.target.checked?(t.isChecked=!0,e.target.nextSibling.classList.add("l-main-task_checked"),saveTasksData()):(t.isChecked=!1,e.target.nextSibling.classList.remove("l-main-task_checked"),saveTasksData()))}),t.filter(e=>e.isChecked).length?("list-TBD"===a.id&&(lockCheckboxesDone(),chooseAllDone.disabled=!0),"list-done"===a.id&&(lockCheckboxesTBD(),chooseAllTBD.disabled=!0)):("list-TBD"===a.id&&(unlockCheckboxesDone(),chooseAllDone.disabled=!1),"list-done"===a.id&&(unlockCheckboxesTBD(),chooseAllTBD.disabled=!1)),massButtonActivity())}function lockCheckboxesDone(){listDone.querySelectorAll(".l-main-task__checkbox").forEach(e=>e.disabled=!0)}function unlockCheckboxesDone(){listDone.querySelectorAll(".l-main-task__checkbox").forEach(e=>e.disabled=!1)}function lockCheckboxesTBD(){listTBD.querySelectorAll(".l-main-task__checkbox").forEach(e=>e.disabled=!0)}function unlockCheckboxesTBD(){listTBD.querySelectorAll(".l-main-task__checkbox").forEach(e=>e.disabled=!1)}function massButtonActivity(){let e=0,t=0;dataTBD.forEach(t=>{t.isChecked&&e++}),dataDone.forEach(e=>{e.isChecked&&t++}),e?(allToDone.disabled=!1,deleteAllTBD.disabled=!1):(allToDone.disabled=!0,deleteAllTBD.disabled=!0),t?(allToExecution.disabled=!1,deleteAllDone.disabled=!1):(allToExecution.disabled=!0,deleteAllDone.disabled=!0)}function massButtonsDisplay(){"0"===counterTBD.innerText?(massButtonsTBD.classList.add("l-main-tasks__mass-action-buttons_hidden"),massButtonsTBD.classList.remove("l-main-tasks__mass-action-buttons_active")):(massButtonsTBD.classList.add("l-main-tasks__mass-action-buttons_active"),massButtonsTBD.classList.remove("l-main-tasks__mass-action-buttons_hidden")),"0"===counterDone.innerText?(massButtonsDone.classList.add("l-main-tasks__mass-action-buttons_hidden"),massButtonsDone.classList.remove("l-main-tasks__mass-action-buttons_active")):(massButtonsDone.classList.add("l-main-tasks__mass-action-buttons_active"),massButtonsDone.classList.remove("l-main-tasks__mass-action-buttons_hidden"))}function editTaskTBD(e){if(e.target.classList.contains("l-main-task__edit-button")){if("edit"===e.target.dataset.edit){resetCheckboxesStatuses(),massButtonActivity(),e.target.classList.add("l-main-task__edit-button_save"),dataTBD.forEach(t=>{e.target.parentNode.dataset.id===t.id&&(t.toEdit=!0)}),saveTasksData(),lockEditButtons(dataTBD);let t=document.createElement("input");return t.style="width: 85%",t.setAttribute("maxlength","30"),t.value=e.target.previousSibling.innerText,e.target.previousSibling.replaceWith(t),t.focus(),e.target.dataset.edit="save",lockCheckboxesDone(),lockCheckboxesTBD(),chooseAllDone.disabled=!0,void(chooseAllTBD.disabled=!0)}if("save"===e.target.dataset.edit){let t=e.target.previousSibling.value,a=e.target.parentNode.dataset.id;dataTBD=t.length?dataTBD.map(e=>e.id===a?(e.text=t,e):e):dataTBD.filter(e=>e.id!==a),saveTasksData(),renderTasks()}}}function editTaskDone(e){if(e.target.classList.contains("l-main-task__edit-button")){if("edit"===e.target.dataset.edit){resetCheckboxesStatuses(),massButtonActivity(),e.target.classList.add("l-main-task__edit-button_save"),dataDone.forEach(t=>{e.target.parentNode.dataset.id===t.id&&(t.toEdit=!0)}),saveTasksData(),lockEditButtons(dataDone);let t=document.createElement("input");return t.style="width: 85%",t.setAttribute("maxlength","30"),t.value=e.target.previousSibling.innerText,e.target.previousSibling.replaceWith(t),t.focus(),e.target.dataset.edit="save",lockCheckboxesDone(),lockCheckboxesTBD(),chooseAllDone.disabled=!0,void(chooseAllTBD.disabled=!0)}if("save"===e.target.dataset.edit){let t=e.target.previousSibling.value,a=e.target.parentNode.dataset.id;dataDone=t.length?dataDone.map(e=>e.id===a?(e.text=t,e):e):dataDone.filter(e=>e.id!==a),saveTasksData(),renderTasks()}}}function lockEditButtons(e){let t=document.querySelectorAll(".l-main-task__edit-button");e.forEach(e=>{e.toEdit&&t.forEach(t=>{e.id!==t.parentNode.dataset.id&&(t.disabled=!0)})})}function deleteTasksTBD(){dataTBD=dataTBD.filter(e=>!e.isChecked),saveTasksData(),renderTasks(),resetCheckboxesStatuses(),massButtonActivity()}function deleteTasksDone(){dataDone=dataDone.filter(e=>!e.isChecked),saveTasksData(),renderTasks(),resetCheckboxesStatuses(),massButtonActivity()}newTaskAdd.addEventListener("click",()=>addNewTask(newTaskText,listTBD)),newTaskText.addEventListener("keyup",e=>{"Enter"===e.code&&addNewTask(newTaskText,listTBD)}),newTaskText.addEventListener("blur",clearNewTaskErrorText),newTaskText.addEventListener("input",()=>{30===newTaskText.value.length?newTaskError.innerText="The maximum number of characters is 30":clearNewTaskErrorText()}),chooseAllTBD.addEventListener("change",()=>chooseAllTasks(dataTBD,chooseAllTBD,listTBD)),chooseAllDone.addEventListener("change",()=>chooseAllTasks(dataDone,chooseAllDone,listDone)),allToDone.addEventListener("click",moveTasksToDone),allToExecution.addEventListener("click",moveTasksToExecution),listTBD.addEventListener("change",()=>chooseTask(event,dataTBD,listTBD)),listDone.addEventListener("change",()=>chooseTask(event,dataDone,listDone)),listTBD.addEventListener("click",()=>editTaskTBD(event)),listDone.addEventListener("click",()=>editTaskDone(event)),deleteAllTBD.addEventListener("click",deleteTasksTBD),deleteAllDone.addEventListener("click",deleteTasksDone),getTasksData(),resetCheckboxesStatuses(),renderTasks();